<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <canvas width="200" height="200"></canvas>
    <script>
        let c = document.querySelector("canvas");
        let ctx = c.getContext("2d");
        main();

        function main() {
            const buffer = makeImageBuffer();
            const scene = makeScene();
            renderScene(scene, buffer);
            showImage(buffer);
        }

        function showImage(imageData) {
            ctx.putImageData(imageData, 0, 0);
        }

        function makeImageBuffer() {
            return ctx.createImageData(c.width, c.height);
        }

        Object.defineProperty(Array.prototype, "x", { get() { return this[0] } })
        Object.defineProperty(Array.prototype, "y", { get() { return this[1] } })
        Object.defineProperty(Array.prototype, "z", { get() { return this[2] } })

        /** @typedef {[number, number,number]} vec_impl */
        /** @typedef {vec_impl|{x: number, y: number, z: number}} vec */
        /** @typedef {{c: vec, r: number}} sphere */
        /** @typedef {{u: vec, t: number}} plane */
        /** @typedef {(sphere | plane)[]} scene */

        /**
         * my scene is a 2x2x2m box with a sphere in it
         * 
         * directions: up y axis, right x axis
         * units: centimeters
         * 
         * @returns {scene}
         * */
        function makeCornellBox() {
            return [
                { c: [10, 20, 0], r: 20 },  // sphere
                { u: [1, 0, 0], t: -100 },  // left
                { u: [1, 0, 0], t: 100 },  // right
                { u: [0, 1, 0], t: 0 },  // floor
                { u: [0, 1, 0], t: 200 },  // ceiling
                // TODO: light?
            ]
        }

        function renderScene(scene, buffer) {

            // camera trace rays equal distance and direction from sensor pos, size, fov (get each pixel initial ray vector)
            // trace scene until collision with sphere or plane
            // calculate reflection angle
            // material can set ratio reflectivity: absorption:,  

            for (let i = 0; i < buffer.data.length; i += 4) {
                buffer.data[i] = 255
                buffer.data[i + 1] = 0
                buffer.data[i + 2] = 0
                buffer.data[i + 3] = 255
            }
        }
    </script>
</body>

</html>